name: Daily Emotion Analysis

on:
  schedule:
    # 매일 한국시간 자정 (UTC 15:00 = KST 00:00)
    - cron: '0 15 * * *'
  workflow_dispatch: # 수동 실행 가능

jobs:
  daily-emotion-analysis:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Install dependencies
      run: |
        cd server
        npm ci
        
    - name: Run Prisma generate
      run: |
        cd server
        npx prisma generate
        
    - name: Run daily emotion analysis
      env:
        DATABASE_URL: ${{ secrets.DATABASE_URL }}
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
      run: |
        cd server
        node -e "
        import('./src/lib/scheduler.js').then(({ scheduleDailyEmotionSummary }) => {
          console.log('Starting daily emotion analysis...');
          scheduleDailyEmotionSummary()
            .then(() => {
              console.log('Daily emotion analysis completed successfully');
              process.exit(0);
            })
            .catch((error) => {
              console.error('Daily emotion analysis failed:', error);
              process.exit(1);
            });
        });
        " 